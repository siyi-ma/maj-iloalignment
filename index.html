<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learning Outcomes Alignment Tool</title>
    <link rel="stylesheet" href="css/shared.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div>
                    <h1><i class="fas fa-graduation-cap"></i> MAJ Intended Learning Outcomes Alignment</h1>
                    <p>Course and Module Learning Outcomes Alignment Tool</p>
                </div>
            </div>
        </header>

        <main>
            <!-- Programme Selection Section -->
            <section id="programme-selection" class="active-section">
                <div id="programmes-container" class="programmes-grid">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>Loading programmes...</p>
                    </div>
                </div>
            </section>

            <!-- Programme Overview Section -->
            <section id="programme-overview" class="hidden-section">
                <div class="programme-header">
                    <button id="back-to-selection" class="back-btn">
                        <i class="fas fa-arrow-left"></i> Back to Programme Selection
                    </button>
                    <div class="programme-title">
                        <h2 id="selected-programme-name"></h2>
                        <p id="selected-programme-description">Choose your analysis path</p>
                    </div>
                </div>

                <div class="section-header">
                    <h2><i class="fas fa-project-diagram"></i> Programme-Module Alignment Analysis</h2>
                    <p>View the comprehensive alignment between Programme Learning Outcomes and Module Learning Outcomes</p>
                    <div class="analysis-action">
                        <div class="analysis-description">
                            <p><i class="fas fa-list"></i> Analyze how well different module learning outcomes align with overall programme learning outcomes</p>
                        </div>
                        <button class="access-btn" id="access-plo-mlo">
                            <i class="fas fa-external-link-alt"></i> Access PLO-MLO Analysis
                        </button>
                    </div>
                </div>

                <div class="section-header">
                    <h2><i class="fas fa-search"></i> Course-Module Alignment</h2>
                    <p>Analyze how Course Learning Outcomes align with Module Learning Outcomes</p>
                    <div class="analysis-action">
                        <div class="analysis-description">
                            <p><i class="fas fa-clipboard-list"></i> Generate and analyze Course Learning Outcomes with AI-powered tools</p>
                        </div>
                        <button class="access-btn" id="access-mlo-clo">
                            <i class="fas fa-external-link-alt"></i> Access MLO-CLO Analysis
                        </button>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>&copy; 2025 ILO Alignment | TalTech Majandusteaduskonna Siyi Ma</p>
        </footer>
    </div>

    <div class="back-to-top">
        <i class="fas fa-arrow-up"></i>
    </div>

    <div class="floating-home">
        <i class="fas fa-home"></i>
    </div>

    <!-- Scripts -->
    <script src="js/data-manager.js"></script>
    <script>
        // Main application controller
        class IndexController {
            constructor() {
                this.currentProgramme = null;
                this.init();
            }

            async init() {
                try {
                    // Load programmes data
                    await window.dataManager.loadProgrammes();
                    this.displayProgrammes();
                    this.setupEventListeners();
                    
                    // Check for programme code in URL
                    const urlParams = new URLSearchParams(window.location.search);
                    const programmeCode = urlParams.get('kavakood');
                    if (programmeCode) {
                        this.selectProgramme(programmeCode);
                    }
                } catch (error) {
                    this.showError('Failed to load programmes. Please refresh the page.');
                    console.error('Initialization error:', error);
                }
            }

            displayProgrammes() {
                const container = document.getElementById('programmes-container');
                const programmes = window.dataManager.getProgrammes();
                
                container.innerHTML = '';
                
                programmes.forEach(programme => {
                    const programmeCard = document.createElement('div');
                    
                    // Check if it's a master's programme (codes ending with 'M')
                    const isMaster = programme.code.toUpperCase().endsWith('M');
                    programmeCard.className = isMaster ? 'programme-card master' : 'programme-card';
                    programmeCard.dataset.code = programme.code;
                    
                    programmeCard.innerHTML = `
                        <div class="programme-content">
                            <h3 class="programme-name-et">${programme.nameEt}</h3>
                            <p class="programme-code">${programme.code}</p>
                            <p class="programme-name-en">${programme.nameEn}</p>
                        </div>
                    `;
                    
                    container.appendChild(programmeCard);
                });
            }

            setupEventListeners() {
                // Programme selection - click anywhere on the card
                document.getElementById('programmes-container').addEventListener('click', (e) => {
                    const card = e.target.closest('.programme-card');
                    if (card) {
                        const programmeCode = card.dataset.code;
                        this.selectProgramme(programmeCode);
                    }
                });

                // Back to selection
                document.getElementById('back-to-selection').addEventListener('click', () => {
                    this.showSection('programme-selection');
                    window.dataManager.clearCurrentProgramme();
                    
                    // Clear URL parameter
                    const url = new URL(window.location);
                    url.searchParams.delete('kavakood');
                    window.history.pushState({}, '', url);
                });

                // Access PLO-MLO Analysis button
                document.getElementById('access-plo-mlo')?.addEventListener('click', () => {
                    const currentProgramme = window.dataManager.getCurrentProgramme();
                    const url = currentProgramme ? `plo-mlo.html?kavakood=${currentProgramme.code}` : 'plo-mlo.html';
                    window.location.href = url;
                });

                // Access MLO-CLO Analysis button
                document.getElementById('access-mlo-clo')?.addEventListener('click', () => {
                    const currentProgramme = window.dataManager.getCurrentProgramme();
                    const url = currentProgramme ? `clo-mlo.html?kavakood=${currentProgramme.code}` : 'clo-mlo.html';
                    window.location.href = url;
                });

                // Back to top
                document.querySelector('.back-to-top').addEventListener('click', () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });

                // Floating home button
                document.querySelector('.floating-home').addEventListener('click', () => {
                    this.showSection('programme-selection');
                    window.dataManager.clearCurrentProgramme();
                    
                    // Clear URL parameter
                    const url = new URL(window.location);
                    url.searchParams.delete('kavakood');
                    window.history.pushState({}, '', url);
                });

                // Show/hide back to top based on scroll
                window.addEventListener('scroll', () => {
                    const backToTop = document.querySelector('.back-to-top');
                    if (window.pageYOffset > 300) {
                        backToTop.style.opacity = '1';
                    } else {
                        backToTop.style.opacity = '0';
                    }
                });
            }

            selectProgramme(programmeCode) {
                try {
                    this.currentProgramme = window.dataManager.setCurrentProgramme(programmeCode);
                    this.displayProgrammeOverview();
                    this.showSection('programme-overview');
                    
                    // Add programme code to URL
                    const url = new URL(window.location);
                    url.searchParams.set('kavakood', programmeCode);
                    window.history.pushState({ programmeCode }, '', url);
                } catch (error) {
                    this.showError(`Failed to select programme: ${error.message}`);
                }
            }

            displayProgrammeOverview() {
                if (!this.currentProgramme) return;

                // Update programme name
                document.getElementById('selected-programme-name').textContent = 
                    this.currentProgramme.kavanimetusik;
            }

            showSection(sectionId) {
                // Hide all sections
                document.querySelectorAll('section').forEach(section => {
                    section.classList.remove('active-section');
                    section.classList.add('hidden-section');
                });

                // Show target section
                const targetSection = document.getElementById(sectionId);
                if (targetSection) {
                    targetSection.classList.remove('hidden-section');
                    targetSection.classList.add('active-section');
                }
            }

            showError(message) {
                // Simple error display - could be enhanced with a modal
                alert(message);
            }
        }

        // Initialize application when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            new IndexController();
        });
    </script>
</body>
</html>