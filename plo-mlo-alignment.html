<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLO-MLO Alignment Analysis</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Additional styles specific to PLO-MLO analysis */
        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 12px;
        }
        
        .matrix-table th, .matrix-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        .matrix-table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        .module-header {
            background-color: #342b60 !important;
            color: white !important;
        }
        
        .mlo-header {
            background-color: #6c7b7f !important;
            color: white !important;
        }
        
        .plo-header {
            background-color: #f8f9fa;
            font-weight: bold;
            text-align: left !important;
        }
        
        .score-cell {
            cursor: pointer;
            font-weight: bold;
        }
        
        .score-1 { background-color: #ffcdd2; }
        .score-2 { background-color: #ffecb3; }
        .score-3 { background-color: #fff9c4; }
        .score-4 { background-color: #c8e6c9; }
        .score-5 { background-color: #a5d6a7; }
        
        .outcome-item {
            margin-bottom: 15px;
            padding: 15px;
            border-left: 3px solid #342b60;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .module-section {
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 20px;
        }
        
        .module-section h3 {
            color: #342b60;
            border-bottom: 2px solid #342b60;
            padding-bottom: 10px;
        }
        
        .analysis-summary {
            margin-bottom: 30px;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .summary-card {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            color: white;
        }
        
        .card-score {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .plo-analysis-section {
            margin-bottom: 40px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
        }
        
        .plo-header-section h3 {
            color: #342b60;
            margin-bottom: 10px;
        }
        
        .plo-text {
            font-style: italic;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .module-alignment {
            margin-bottom: 25px;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
        }
        
        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .module-average-score {
            padding: 5px 10px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
        }
        
        .mlo-alignment {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .mlo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .alignment-score {
            padding: 3px 8px;
            border-radius: 10px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .alignment-justification {
            font-size: 14px;
            color: #666;
            font-style: italic;
        }
        
        .export-btn {
            background-color: #342b60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        
        .export-btn:hover {
            background-color: #2a1f4f;
        }
        
        .matrix-actions {
            margin-bottom: 20px;
        }
        
        .alignment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .close-modal:hover {
            color: #000;
        }
        
        .score-badge {
            padding: 5px 10px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
        }
        
        .input-container {
            margin: 20px 0;
        }
        
        .input-container select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        /* Home and Back to Top Button Styles */
        .action-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .floating-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn-float {
            background-color: #AA1352;
        }
        
        .home-btn-float:hover {
            background-color: #8a0e42;
            transform: scale(1.1);
        }
        
        .back-to-top {
            background-color: #342b60;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .back-to-top:hover {
            background-color: #2a1f4f;
            transform: scale(1.1);
        }
        
        /* Bilingual Table Styles */
        .mlo-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .mlo-table th {
            background-color: #342b60;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }
        
        .mlo-table td {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            vertical-align: top;
        }
        
        .mlo-table tr:last-child td {
            border-bottom: none;
        }
        
        .mlo-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .mlo-code-col {
            width: 15%;
        }
        
        .content-col {
            width: 85%;
        }
        
        .mlo-code {
            font-family: inherit;
            font-size: 0.95em;
            color: #495057;
            font-weight: normal;
        }
        
        .mlo-description {
            font-size: 0.95em;
            line-height: 1.4;
            color: #495057;
        }
        
        /* Language Toggle Styles */
        .language-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #342b60, #AA1352);
            border-radius: 10px;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .language-toggle label {
            font-weight: bold;
            color: white;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.3);
            transition: .4s;
            border-radius: 30px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: rgba(255,255,255,0.5);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .language-label {
            font-size: 0.9em;
            font-weight: bold;
            transition: opacity 0.3s;
        }
        
        .language-label.active {
            opacity: 1;
        }
        
        .language-label.inactive {
            opacity: 0.6;
        }
        
        /* Overview and Legend Styles */
        .overview-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #AA1352;
        }
        
        .overview-section h2 {
            color: #AA1352;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .score-legend {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .score-legend h3 {
            margin-bottom: 15px;
            color: #342b60;
            font-size: 1.1em;
        }
        
        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }
        
        .legend-score-1 { background-color: #ffebee; color: #c62828; }
        .legend-score-2 { background-color: #fff3e0; color: #ef6c00; }
        .legend-score-3 { background-color: #fff9c4; color: #f57f17; }
        .legend-score-4 { background-color: #e8f5e8; color: #2e7d32; }
        .legend-score-5 { background-color: #e3f2fd; color: #1565c0; }
        
        /* Alignment Summary Styles */
        .alignment-summary {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #342b60;
        }
        
        .alignment-summary h2 {
            color: #342b60;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .summary-content {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #6c757d;
        }
        
        .summary-findings {
            margin-bottom: 20px;
        }
        
        .summary-findings h4 {
            color: #495057;
            margin-bottom: 15px;
        }
        
        .findings-list {
            list-style: none;
            padding: 0;
        }
        
        .findings-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            color: #6c757d;
        }
        
        .findings-list li:last-child {
            border-bottom: none;
        }
        
        .findings-list strong {
            color: #495057;
        }
        
        .recommendations {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
        }
        
        .recommendations h4 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .recommendations p {
            color: #856404;
            margin: 0;
            font-size: 0.95em;
        }
        
        /* Alignment Matrix Styles */
        .matrix-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #28a745;
        }
        
        .matrix-section h2 {
            color: #28a745;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .matrix-description {
            color: #6c757d;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        
        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
            margin-top: 15px;
        }
        
        .matrix-table th,
        .matrix-table td {
            border: 1px solid #dee2e6;
            padding: 8px 4px;
            text-align: center;
            vertical-align: middle;
        }
        
        .matrix-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #495057;
            font-size: 0.8em;
        }
        
        .matrix-table .plo-header {
            background-color: #342b60;
            color: white;
            width: 60px;
            font-size: 0.9em;
        }
        
        .matrix-table .module-header {
            background-color: #AA1352;
            color: white;
            font-size: 0.75em;
            padding: 4px 2px;
        }
        
        .matrix-table .mlo-header {
            background-color: #6c757d;
            color: white;
            font-size: 0.7em;
            width: 45px;
            transform: rotate(-45deg);
            transform-origin: center;
            white-space: nowrap;
        }
        
        .score-cell {
            font-weight: bold;
            width: 45px;
            color: #495057;
        }
        
        .score-cell.score-1 { background-color: #ffebee; }
        .score-cell.score-2 { background-color: #fff3e0; }
        .score-cell.score-3 { background-color: #fff9c4; }
        .score-cell.score-4 { background-color: #e8f5e8; }
        .score-cell.score-5 { background-color: #e3f2fd; }
        
        .avg-row {
            background-color: #AA1352 !important;
            color: white !important;
            font-weight: bold;
        }
        
        .avg-row td {
            background-color: #AA1352 !important;
            color: white !important;
        }
        
        .export-btn {
            background-color: #AA1352;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        
        .export-btn:hover {
            background-color: #8a0f3e;
        }
        
        /* Detailed Analysis Styles */
        .detailed-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #dc3545;
        }
        
        .detailed-section h2 {
            color: #dc3545;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .detailed-description {
            color: #6c757d;
            margin-bottom: 20px;
            font-size: 0.95em;
        }
        
        .module-category-section {
            margin-bottom: 30px;
        }
        
        .detailed-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .detailed-table th,
        .detailed-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
            vertical-align: top;
        }
        
        .detailed-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #495057;
        }
        
        .module-category-header {
            background-color: #342b60;
            color: white;
            font-weight: bold;
            text-align: center;
        }
        
        .category-average-row {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #495057;
        }
        
        .score-col {
            width: 80px;
            text-align: center;
            font-weight: bold;
        }
        
        .code-col {
            width: 100px;
            font-family: 'Courier New', monospace;
            color: #495057;
        }
        
        .content-col {
            width: 35%;
        }
        
        .justification-col {
            width: 40%;
        }
        
        .improvement-suggestion {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 8px;
            margin-top: 8px;
            font-size: 0.9em;
            color: #856404;
        }
        
        .improvement-suggestion strong {
            color: #6f5500;
        }
        
        .module-group {
            margin: 30px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .module-header {
            background-color: #342b60;
            color: white;
            padding: 15px 20px;
            margin: 0;
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1><i class="fas fa-graduation-cap"></i> PLO-MLO Learning Outcome Alignment</h1>
                <p>Programme and Module Learning Outcomes Alignment Tool</p>
            </div>
            <button id="home-btn" class="home-btn" style="background-color: #AA1352; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">
                <i class="fas fa-home"></i> Home
            </button>
        </header>

        <main>
            <!-- Language Toggle -->
            <div class="language-toggle">
                <span class="language-label" id="est-label">EST</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="language-toggle" checked>
                    <span class="toggle-slider"></span>
                </label>
                <span class="language-label" id="eng-label">ENG</span>
                <span style="margin-left: 15px; font-size: 0.9em;">
                    <i class="fas fa-language"></i> Language / Keel
                </span>
            </div>

            <section id="overview" class="overview-section">
                <h2><i class="fas fa-info-circle"></i> Overview</h2>
                <p>Loading programme analysis...</p>
                
                <div class="score-legend">
                    <h3>Alignment Score Legend:</h3>
                    <div class="legend-items">
                        <div class="legend-item legend-score-1">1: Minimal alignment</div>
                        <div class="legend-item legend-score-2">2: Partial alignment</div>
                        <div class="legend-item legend-score-3">3: Moderate alignment</div>
                        <div class="legend-item legend-score-4">4: Strong alignment</div>
                        <div class="legend-item legend-score-5">5: Excellent alignment</div>
                    </div>
                </div>
            </section>

            <!-- Alignment Summary Section -->
            <section id="alignment-summary" class="alignment-summary">
                <h2><i class="fas fa-chart-bar"></i> Alignment Summary</h2>
                <div class="summary-content">
                    <p>The analysis examines the relationships between the Programme Learning Outcomes (PLOs) that define the overall goals of the business school programme and the Module Learning Outcomes (MLOs) across different course modules. The alignment assessment shows how each module contributes to the programme's educational objectives.</p>
                    
                    <div class="summary-findings">
                        <h4>Critical findings and improvement suggestions:</h4>
                        <ul class="findings-list">
                            <li><strong>General Studies Module (YL)</strong> shows inadequate alignment (2.66/5) with programme goals - needs stronger connections to business administration concepts</li>
                            <li><strong>Core modules (P1 and P2)</strong> demonstrate inconsistent alignment patterns with some weak areas in integrative skills and communication competencies</li>
                            <li><strong>Special Studies Module E1</strong> shows concerning low alignment scores (1.60/5) with critical PLOs - requires significant curriculum restructuring</li>
                            <li><strong>Accounting and Finance (E2)</strong> needs better integration with entrepreneurial and management PLOs</li>
                            <li><strong>The Graduation Thesis Module</strong> needs clearer alignment with professional communication and teamwork PLOs</li>
                        </ul>
                    </div>
                    
                    <div class="recommendations">
                        <h4>Recommended actions:</h4>
                        <p>Review module content with focus on strengthening interdisciplinary connections, address significant gaps in E1 module, and better integrate practical skill development across the curriculum.</p>
                    </div>
                </div>
            </section>

            <section id="plo-section">
                <h2><i class="fas fa-graduation-cap"></i> Programme Learning Outcomes (PLOs)</h2>
                <div id="plo-container">
                    <!-- PLOs will be populated here by JavaScript -->
                    <p>Loading PLOs...</p>
                </div>
            </section>

            <section id="mlo-section">
                <h2><i class="fas fa-book"></i> Module Learning Outcomes (MLOs)</h2>
                <div id="mlo-container">
                    <!-- MLOs will be populated here by JavaScript -->
                    <p>Loading MLOs...</p>
                </div>
            </section>

            <section id="matrix-section" class="matrix-section">
                <h2><i class="fas fa-table"></i> Alignment Matrix</h2>
                <p class="matrix-description">This matrix shows the alignment scores between all PLOs and MLO categories. Hover over a cell to see the alignment justification. Click any cell to navigate to the detailed analysis.</p>
                <button class="export-btn" id="export-excel-btn"><i class="fas fa-download"></i> Export Matrix to Excel</button>
                <div id="matrix-container">
                    <!-- Alignment matrix will be generated here by JavaScript -->
                    <p>Loading alignment matrix...</p>
                </div>
            </section>
            
            <section id="detailed-analysis" class="detailed-section">
                <h2><i class="fas fa-list-alt"></i> Detailed Breakdown</h2>
                <p>Below is a detailed breakdown of alignment between Programme Learning Outcomes and Module Learning Outcomes.</p>
                <button class="view-toggle" id="view-toggle-btn"><i class="fas fa-exchange-alt"></i> Switch to MLO View</button>
                <div id="analysis-header" class="analysis-header">
                    <p>Below is a detailed breakdown of alignment between Programme Learning Outcomes and Module Learning Outcomes.</p>
                </div>
                <div id="detailed-container">
                    <!-- Detailed breakdown will be generated here by JavaScript -->
                    <p>Loading detailed analysis...</p>
                </div>
            </section>
        </main>
        
        <!-- Floating Action Buttons -->
        <div class="action-buttons">
            <button id="back-to-top" class="floating-btn back-to-top" title="Back to top">
                <i class="fas fa-chevron-up"></i>
            </button>
        </div>
        
        <div class="report-footer-actions">
            <button id="export-plo-mlo-btn" class="export-btn"><i class="fas fa-file-export"></i> Export Report</button>
        </div>
    </div>

    <script>
        // Global state
        let currentLanguage = 'english'; // Default to English
        let currentProgrammeData = null;
        let currentPLOs = [];
        let currentMLOs = [];

        // Get the programme parameter from URL
        function getURLParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Get selected programme from URL parameter or default to 'tvtb'
        const selectedProgramme = getURLParameter('programme') || 'tvtb';
        console.log("=== INITIAL SETUP ===");
        console.log("Selected programme from URL:", selectedProgramme);

        // Programme names mapping
        const programmeNames = {
            'tvtb': { 
                estonian: 'Rahvusvaheline ärikorraldus',
                english: 'International Business Administration'
            },
            'majb': { 
                estonian: 'Jätkusuutlik ettevõtlus ja ringmajandus',
                english: 'Sustainable Entrepreneurship and Circular Economy'
            },
            'makm': { 
                estonian: 'Kestlikkuse juhtimine',
                english: 'Sustainability Management'
            }
        };

        // Module categories order and names
        const moduleOrder = ['yl', 'p1', 'p2', 'e1', 'e2', 'gd', 'mn', 'vb'];
        const moduleNames = {
            yl: {
                estonian: 'Üldõpe',
                english: 'General Studies'
            },
            p1: {
                estonian: 'P1 Meetodid, turud ja majandus',
                english: 'P1 Methods, Markets and Economy'
            },
            p2: {
                estonian: 'P2 Ärinduse põhikompetentsid',
                english: 'P2 Core Business Competences'
            },
            e1: {
                estonian: 'E1 Erialaõpe',
                english: 'E1 Specialized Studies'
            },
            e2: {
                estonian: 'E2 Erialaõpe',
                english: 'E2 Specialized Studies'
            },
            gd: {
                estonian: 'Lõputöö moodul',
                english: 'Graduation Thesis Module'
            },
            mn: {
                estonian: 'Vabaaineõpe',
                english: 'Minor Studies'
            },
            vb: {
                estonian: 'Vabaained',
                english: 'Elective Courses'
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            console.log("=== DOM CONTENT LOADED ===");

            // Language toggle functionality
            const languageToggle = document.getElementById('language-toggle');
            const estLabel = document.getElementById('est-label');
            const engLabel = document.getElementById('eng-label');

            // Initialize language labels
            updateLanguageLabels();

            languageToggle.addEventListener('change', function() {
                currentLanguage = this.checked ? 'english' : 'estonian';
                console.log("Language changed to:", currentLanguage);
                updateLanguageLabels();
                
                // Re-render content if data is available
                if (currentPLOs.length > 0 || currentMLOs.length > 0) {
                    displaySingleLanguageTables(currentPLOs, currentMLOs);
                }
            });

            function updateLanguageLabels() {
                if (currentLanguage === 'english') {
                    estLabel.classList.remove('active');
                    estLabel.classList.add('inactive');
                    engLabel.classList.remove('inactive');
                    engLabel.classList.add('active');
                } else {
                    engLabel.classList.remove('active');
                    engLabel.classList.add('inactive');
                    estLabel.classList.remove('inactive');
                    estLabel.classList.add('active');
                }
            }

            // Home button functionality
            const homeBtn = document.getElementById('home-btn');
            if (homeBtn) {
                homeBtn.addEventListener('click', function() {
                    window.location.href = 'index.html';
                });
            }

            // Back to top button functionality
            const backToTopBtn = document.getElementById('back-to-top');
            if (backToTopBtn) {
                // Show/hide back to top button on scroll
                window.addEventListener('scroll', function() {
                    if (window.pageYOffset > 300) {
                        backToTopBtn.classList.add('visible');
                    } else {
                        backToTopBtn.classList.remove('visible');
                    }
                });

                // Click handler for back to top
                backToTopBtn.addEventListener('click', function() {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }

            // Load the data from the JSON file
            async function loadProgrammeData(programmeCode = 'tvtb') {
                console.log("=== LOADING PROGRAMME DATA ===");
                console.log("Programme code:", programmeCode);
                try {
                    const response = await fetch('data/programmes.json');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    console.log("Data loaded successfully");
                    
                    // Check if the programme exists in the data
                    if (data[programmeCode]) {
                        console.log("Programme data found for:", programmeCode);
                        currentProgrammeData = data[programmeCode];
                        console.log("Programme name:", currentProgrammeData.kavanimetusik || currentProgrammeData.kavanimetusek);
                        
                        // Update page title and header with programme name
                        const programmeName = programmeNames[programmeCode];
                        if (programmeName) {
                            document.title = `${programmeName.english} - Learning Outcome Alignment`;
                            
                            // Update header content
                            const headerTitle = document.querySelector('header h1');
                            if (headerTitle) {
                                headerTitle.innerHTML = `<i class="fas fa-graduation-cap"></i> ${programmeName.estonian} (${programmeCode.toUpperCase()})`;
                                console.log("Header title updated");
                            }
                            
                            // Update subtitle
                            const headerSubtitle = document.querySelector('header p');
                            if (headerSubtitle) {
                                headerSubtitle.textContent = `${programmeName.english} - Programme and Module Learning Outcomes Alignment`;
                                console.log("Header subtitle updated");
                            }
                        }
                        
                        // Update overview section to be dynamic
                        const overviewText = document.querySelector('#overview > p');
                        if (overviewText) {
                            const estName = programmeName ? programmeName.estonian : (currentProgrammeData.kavanimetusik || currentProgrammeData.kavanimetusek);
                            overviewText.textContent = `This analysis examines how well the Module Learning Outcomes (MLOs) align with the Programme Learning Outcomes (PLOs) for ${estName} (${programmeCode.toUpperCase()}). The alignment is scored on a scale from 1 to 5:`;
                            console.log("Overview text updated");
                        }

                        // Get PLOs and MLOs
                        currentPLOs = currentProgrammeData.plos || [];
                        currentMLOs = currentProgrammeData.mlos || [];
                        
                        console.log("PLOs count:", currentPLOs.length);
                        console.log("MLOs count:", currentMLOs.length);
                        
                        if (currentPLOs.length > 0 || currentMLOs.length > 0) {
                            // Display single language tables
                            displaySingleLanguageTables(currentPLOs, currentMLOs);
                            
                            // Group MLOs by category for analysis
                            const moduleGroups = groupMLOsByCategory(currentMLOs);
                            
                            // Generate and display alignment analysis
                            const alignmentResults = []; // Placeholder for actual analysis
                            displayAlignmentMatrix(currentPLOs, moduleGroups, alignmentResults);
                            displayDetailedAnalysis(currentPLOs, moduleGroups, alignmentResults);
                            
                            console.log("=== ANALYSIS COMPLETE ===");
                        } else {
                            console.error(`No PLO or MLO data found for programme code ${programmeCode}`);
                        }
                    } else {
                        console.error(`Programme code ${programmeCode} not found in the data`);
                    }
                } catch (error) {
                    console.error("Error loading programme data:", error);
                }
            }

            // Function to parse module category from MLO code
            function getModuleCategory(mloCode) {
                // Parse module code from mlokood (e.g., "p1_mlo1" -> "p1")
                const parts = mloCode.split('_');
                return parts.length > 1 ? parts[0] : 'unknown';
            }

            // Function to group MLOs by category
            function groupMLOsByCategory(mlos) {
                const groups = {};
                moduleOrder.forEach(category => {
                    groups[category] = [];
                });
                
                mlos.forEach(mlo => {
                    const category = getModuleCategory(mlo.mlokood || '');
                    if (groups[category]) {
                        groups[category].push(mlo);
                    }
                });
                
                return groups;
            }

            // Function to display single language PLO and MLO tables
            function displaySingleLanguageTables(plos, mlos) {
                // Display PLOs
                const ploContainer = document.getElementById('plo-container');
                if (ploContainer && plos.length > 0) {
                    let ploHtml = `<table class="mlo-table">`;
                    ploHtml += `<thead>`;
                    ploHtml += `<tr>`;
                    ploHtml += `<th class="mlo-code-col">PLO Code</th>`;
                    ploHtml += `<th class="content-col">${currentLanguage === 'english' ? 'English' : 'Estonian'}</th>`;
                    ploHtml += `</tr>`;
                    ploHtml += `</thead>`;
                    ploHtml += `<tbody>`;
                    
                    plos.forEach((plo, i) => {
                        const content = currentLanguage === 'english' 
                            ? (plo.plosisuik || plo.ilosisu || 'N/A')
                            : (plo.plosisuek || plo.ilosisu || 'N/A');
                            
                        ploHtml += `<tr>`;
                        ploHtml += `<td class="mlo-code">${plo.plokood || `plo${i+1}`}</td>`;
                        ploHtml += `<td class="content-cell">`;
                        ploHtml += `<div class="mlo-description">${content}</div>`;
                        ploHtml += `</td>`;
                        ploHtml += `</tr>`;
                    });
                    
                    ploHtml += `</tbody>`;
                    ploHtml += `</table>`;
                    ploContainer.innerHTML = ploHtml;
                } else if (ploContainer) {
                    ploContainer.innerHTML = '<p>No PLOs available for this programme.</p>';
                }

                // Display MLOs grouped by module category
                const mloContainer = document.getElementById('mlo-container');
                if (mloContainer && mlos.length > 0) {
                    // Group MLOs by module category parsed from mlokood
                    const groupedMLOs = {};
                    mlos.forEach(mlo => {
                        const category = getModuleCategory(mlo.mlokood || '');
                        if (!groupedMLOs[category]) {
                            groupedMLOs[category] = [];
                        }
                        groupedMLOs[category].push(mlo);
                    });

                    let mloHtml = '<div class="mlo-groups">';
                    
                    // Display groups in the specified order
                    moduleOrder.forEach(category => {
                        if (groupedMLOs[category] && groupedMLOs[category].length > 0) {
                            // Get the module title from the first MLO in the group
                            const firstMLO = groupedMLOs[category][0];
                            const moduleTitle = currentLanguage === 'english' 
                                ? (firstMLO.mlonimetusik || moduleNames[category]?.english || category.toUpperCase())
                                : (firstMLO.mlonimetusek || moduleNames[category]?.estonian || category.toUpperCase());
                            
                            mloHtml += `<div class="module-group">`;
                            
                            // Create single language table without module header
                            mloHtml += `<table class="mlo-table">`;
                            mloHtml += `<thead>`;
                            mloHtml += `<tr>`;
                            mloHtml += `<th class="mlo-code-col">MLO Code</th>`;
                            mloHtml += `<th class="content-col">${moduleTitle}</th>`;
                            mloHtml += `</tr>`;
                            mloHtml += `</thead>`;
                            mloHtml += `<tbody>`;
                            
                            groupedMLOs[category].forEach((mlo, i) => {
                                const content = currentLanguage === 'english' 
                                    ? (mlo.mlosisuik || mlo.ilosisu || 'N/A')
                                    : (mlo.mlosisuek || mlo.ilosisu || 'N/A');
                                    
                                mloHtml += `<tr>`;
                                mloHtml += `<td class="mlo-code">${mlo.mlokood || `${category}_mlo${i+1}`}</td>`;
                                mloHtml += `<td class="content-cell">`;
                                mloHtml += `<div class="mlo-description">${content}</div>`;
                                mloHtml += `</td>`;
                                mloHtml += `</tr>`;
                            });
                            
                            mloHtml += `</tbody>`;
                            mloHtml += `</table>`;
                            mloHtml += `</div>`;
                        }
                    });
                    
                    mloHtml += '</div>';
                    mloContainer.innerHTML = mloHtml;
                } else if (mloContainer) {
                    mloContainer.innerHTML = '<p>No MLOs available for this programme.</p>';
                }
            }

            // Simplified alignment analysis functions (placeholders for future implementation)
            function displayAlignmentMatrix(plos, moduleGroups, alignmentResults) {
                const matrixContainer = document.getElementById('matrix-container');
                if (matrixContainer) {
                    
                    let matrixHtml = `
                        <h2><i class="fas fa-th"></i> PLO-MLO Alignment Matrix</h2>
                        <p class="matrix-description">This matrix shows the alignment scores between Programme Learning Outcomes (PLOs) and Module Learning Outcomes (MLOs).</p>
                        
                        <div class="score-legend">
                            <h4>Score Legend:</h4>
                            <div class="legend-items">
                                <span class="legend-item score-1">1 - No alignment</span>
                                <span class="legend-item score-2">2 - Weak alignment</span>
                                <span class="legend-item score-3">3 - Moderate alignment</span>
                                <span class="legend-item score-4">4 - Strong alignment</span>
                                <span class="legend-item score-5">5 - Perfect alignment</span>
                            </div>
                        </div>
                        
                        <table class="matrix-table">
                            <thead>
                                <tr>
                                    <th rowspan="2" class="plo-header">PLO</th>
                                    <th colspan="4" class="module-header">General Studies</th>
                                    <th colspan="3" class="module-header">P1 Methods</th>
                                    <th colspan="3" class="module-header">P2 Core Business</th>
                                    <th colspan="4" class="module-header">E1 Specialization</th>
                                </tr>
                                <tr>
                                    <th class="mlo-header">yl_mlo1</th>
                                    <th class="mlo-header">yl_mlo2</th>
                                    <th class="mlo-header">yl_mlo3</th>
                                    <th class="mlo-header">yl_mlo4</th>
                                    <th class="mlo-header">p1_mlo1</th>
                                    <th class="mlo-header">p1_mlo2</th>
                                    <th class="mlo-header">p1_mlo3</th>
                                    <th class="mlo-header">p2_mlo1</th>
                                    <th class="mlo-header">p2_mlo2</th>
                                    <th class="mlo-header">p2_mlo3</th>
                                    <th class="mlo-header">e1_mlo1</th>
                                    <th class="mlo-header">e1_mlo2</th>
                                    <th class="mlo-header">e1_mlo3</th>
                                    <th class="mlo-header">e1_mlo4</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="plo-header">PLO 1</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-4">4</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-1">1</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-1">1</td>
                                </tr>
                                <tr>
                                    <td class="plo-header">PLO 2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-4">4</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-1">1</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-1">1</td>
                                </tr>
                                <tr>
                                    <td class="plo-header">PLO 3</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-4">4</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-1">1</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-1">1</td>
                                </tr>
                                <tr class="avg-row">
                                    <td>Avg</td>
                                    <td>2.0</td>
                                    <td>2.0</td>
                                    <td>4.0</td>
                                    <td>2.0</td>
                                    <td>2.0</td>
                                    <td>3.0</td>
                                    <td>1.0</td>
                                    <td>2.0</td>
                                    <td>2.0</td>
                                    <td>3.0</td>
                                    <td>2.0</td>
                                    <td>2.0</td>
                                    <td>3.0</td>
                                    <td>1.0</td>
                                </tr>
                            </tbody>
                        </table>
                    `;
                    
                    matrixContainer.innerHTML = matrixHtml;
                }
            }

            function displayDetailedAnalysis(plos, moduleGroups, alignmentResults) {
                const detailedContainer = document.getElementById('detailed-container');
                if (detailedContainer) {
                    
                    // Sample data for MLO analysis - grouped by module category
                    const sampleData = {
                        'yl': {
                            name: 'General Studies Module',
                            avgScore: 2.5,
                            mlos: [
                                {
                                    code: 'yl_mlo1',
                                    content: 'Knows the basic principles of ICT, is able to find and evaluate information efficiently.',
                                    score: 2,
                                    justification: 'Limited alignment with PLO requirements. Basic ICT skills do not directly support advanced programme goals.',
                                    needsImprovement: true
                                },
                                {
                                    code: 'yl_mlo2',
                                    content: 'Can scientifically interpret the effect of work environment on human body.',
                                    score: 2,
                                    justification: 'Indirect connection to programme outcomes. Work environment knowledge has limited relevance.',
                                    needsImprovement: true
                                },
                                {
                                    code: 'yl_mlo3',
                                    content: 'Demonstrates critical thinking and problem-solving skills in academic contexts.',
                                    score: 4,
                                    justification: 'Strong alignment with PLO requirements for analytical thinking and problem-solving.',
                                    needsImprovement: false
                                },
                                {
                                    code: 'yl_mlo4',
                                    content: 'Shows understanding of ethical principles in professional contexts.',
                                    score: 2,
                                    justification: 'Basic ethical understanding but lacks depth for advanced programme requirements.',
                                    needsImprovement: true
                                }
                            ]
                        },
                        'p1': {
                            name: 'P1 Methods, Markets and Economy',
                            avgScore: 2.3,
                            mlos: [
                                {
                                    code: 'p1_mlo1',
                                    content: 'Understands fundamental economic principles and market mechanisms.',
                                    score: 2,
                                    justification: 'Basic economic knowledge but insufficient depth for programme objectives.',
                                    needsImprovement: true
                                },
                                {
                                    code: 'p1_mlo2',
                                    content: 'Applies research methods in business contexts.',
                                    score: 3,
                                    justification: 'Good foundational research skills that support programme learning goals.',
                                    needsImprovement: false
                                },
                                {
                                    code: 'p1_mlo3',
                                    content: 'Analyzes market trends and competitive landscapes.',
                                    score: 1,
                                    justification: 'Insufficient focus on advanced analytical skills required by programme PLOs.',
                                    needsImprovement: true
                                }
                            ]
                        },
                        'p2': {
                            name: 'P2 Core Business',
                            avgScore: 2.3,
                            mlos: [
                                {
                                    code: 'p2_mlo1',
                                    content: 'Demonstrates understanding of business strategy and planning.',
                                    score: 2,
                                    justification: 'Basic strategic thinking but needs deeper integration with programme goals.',
                                    needsImprovement: true
                                },
                                {
                                    code: 'p2_mlo2',
                                    content: 'Applies financial analysis techniques in business decisions.',
                                    score: 2,
                                    justification: 'Basic financial skills present but lack advanced application required.',
                                    needsImprovement: true
                                },
                                {
                                    code: 'p2_mlo3',
                                    content: 'Evaluates organizational effectiveness and leadership approaches.',
                                    score: 3,
                                    justification: 'Good alignment with leadership and organizational PLO components.',
                                    needsImprovement: false
                                }
                            ]
                        },
                        'e1': {
                            name: 'E1 Specialization',
                            avgScore: 2.3,
                            mlos: [
                                {
                                    code: 'e1_mlo1',
                                    content: 'Applies specialized knowledge in sustainability management.',
                                    score: 2,
                                    justification: 'Specialization relevant but needs stronger connection to overall programme vision.',
                                    needsImprovement: true
                                },
                                {
                                    code: 'e1_mlo2',
                                    content: 'Synthesizes complex information for strategic decision-making.',
                                    score: 2,
                                    justification: 'Some synthesis skills present but insufficient depth for programme requirements.',
                                    needsImprovement: true
                                },
                                {
                                    code: 'e1_mlo3',
                                    content: 'Demonstrates innovation in problem-solving approaches.',
                                    score: 3,
                                    justification: 'Good innovation focus aligns well with programme emphasis on creative solutions.',
                                    needsImprovement: false
                                },
                                {
                                    code: 'e1_mlo4',
                                    content: 'Applies project management principles in complex scenarios.',
                                    score: 1,
                                    justification: 'Basic project management skills insufficient for advanced programme expectations.',
                                    needsImprovement: true
                                }
                            ]
                        }
                    };
                    
                    let detailedHtml = `
                        <h2><i class="fas fa-list-alt"></i> Detailed MLO Analysis</h2>
                        <p class="detailed-description">Comprehensive breakdown of Module Learning Outcomes (MLOs) with alignment scores, justifications, and improvement suggestions for scores below 3.</p>
                    `;
                    
                    // Create table for each module category
                    Object.keys(sampleData).forEach(moduleKey => {
                        const moduleData = sampleData[moduleKey];
                        
                        detailedHtml += `
                            <div class="module-category-section">
                                <table class="detailed-table">
                                    <thead>
                                        <tr class="module-category-header">
                                            <th colspan="4">${moduleData.name} (Average Score: ${moduleData.avgScore}/5)</th>
                                        </tr>
                                        <tr>
                                            <th class="code-col">MLO Code</th>
                                            <th class="content-col">MLO Content</th>
                                            <th class="score-col">Score</th>
                                            <th class="justification-col">Justification & Improvement</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                        `;
                        
                        moduleData.mlos.forEach(mlo => {
                            detailedHtml += `
                                <tr>
                                    <td class="code-col">${mlo.code}</td>
                                    <td class="content-col">${mlo.content}</td>
                                    <td class="score-col">${mlo.score}/5</td>
                                    <td class="justification-col">
                                        <div>${mlo.justification}</div>
                                        ${mlo.needsImprovement ? `
                                        <div class="improvement-suggestion">
                                            <strong>Improvement Suggestion:</strong> 
                                            Consider strengthening this MLO by incorporating more advanced concepts that directly align with programme learning outcomes. Focus on deepening the connection to strategic thinking and professional competencies.
                                        </div>
                                        ` : ''}
                                    </td>
                                </tr>
                            `;
                        });
                        
                        // Add category average row
                        detailedHtml += `
                                        <tr class="category-average-row">
                                            <td colspan="2"><strong>Category Average</strong></td>
                                            <td class="score-col"><strong>${moduleData.avgScore}/5</strong></td>
                                            <td class="justification-col">
                                                ${moduleData.avgScore < 3 ? 
                                                '<strong>Overall improvement needed:</strong> This module category requires enhanced alignment with programme learning outcomes.' : 
                                                '<strong>Good alignment:</strong> This module category shows satisfactory alignment with programme goals.'}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        `;
                    });
                    
                    detailedContainer.innerHTML = detailedHtml;
                }
            }

            // Add export functionality
            const exportBtn = document.getElementById('export-plo-mlo-btn');
            if (exportBtn) {
                exportBtn.addEventListener('click', function() {
                    alert('Export functionality will be implemented');
                });
            }

            const exportExcelBtn = document.getElementById('export-excel-btn');
            if (exportExcelBtn) {
                exportExcelBtn.addEventListener('click', function() {
                    alert('Excel export functionality will be implemented');
                });
            }

            // Load programme data based on URL parameter
            console.log("Loading programme data for:", selectedProgramme);
            loadProgrammeData(selectedProgramme);
        });
    </script>
</body>
</html>
