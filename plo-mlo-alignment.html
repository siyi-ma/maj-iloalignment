<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PLO-MLO Alignment Analysis</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* Additional styles specific to PLO-MLO analysis */
        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 12px;
        }
        
        .matrix-table th, .matrix-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        
        .matrix-table th {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        
        .module-header {
            background-color: #342b60 !important;
            color: white !important;
        }
        
        .mlo-header {
            background-color: #6c7b7f !important;
            color: white !important;
        }
        
        .plo-header {
            background-color: #f8f9fa;
            font-weight: bold;
            text-align: left !important;
        }
        
        .score-cell {
            cursor: pointer;
            font-weight: bold;
        }
        
        .score-1 { background-color: #ffcdd2; }
        .score-2 { background-color: #ffecb3; }
        .score-3 { background-color: #fff9c4; }
        .score-4 { background-color: #c8e6c9; }
        .score-5 { background-color: #a5d6a7; }
        
        .outcome-item {
            margin-bottom: 15px;
            padding: 15px;
            border-left: 3px solid #342b60;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .module-section {
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 20px;
        }
        
        .module-section h3 {
            color: #342b60;
            border-bottom: 2px solid #342b60;
            padding-bottom: 10px;
        }
        
        .analysis-summary {
            margin-bottom: 30px;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .summary-card {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            color: white;
        }
        
        .card-score {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .plo-analysis-section {
            margin-bottom: 40px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
        }
        
        .plo-header-section h3 {
            color: #342b60;
            margin-bottom: 10px;
        }
        
        .plo-text {
            font-style: italic;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .module-alignment {
            margin-bottom: 25px;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
        }
        
        .module-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .module-average-score {
            padding: 5px 10px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
        }
        
        .mlo-alignment {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        
        .mlo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .alignment-score {
            padding: 3px 8px;
            border-radius: 10px;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .alignment-justification {
            font-size: 14px;
            color: #666;
            font-style: italic;
        }
        
        .export-btn {
            background-color: #342b60;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        
        .export-btn:hover {
            background-color: #2a1f4f;
        }
        
        .matrix-actions {
            margin-bottom: 20px;
        }
        
        .alignment-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .close-modal:hover {
            color: #000;
        }
        
        .score-badge {
            padding: 5px 10px;
            border-radius: 15px;
            color: white;
            font-weight: bold;
        }
        
        .input-container {
            margin: 20px 0;
        }
        
        .input-container select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        /* Home and Back to Top Button Styles */
        .action-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .floating-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .home-btn-float {
            background-color: #AA1352;
        }
        
        .home-btn-float:hover {
            background-color: #8a0e42;
            transform: scale(1.1);
        }
        
        .back-to-top {
            background-color: #342b60;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }
        
        .back-to-top:hover {
            background-color: #2a1f4f;
            transform: scale(1.1);
        }
        
        /* Bilingual Table Styles */
        .mlo-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .mlo-table th {
            background-color: #342b60;
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: bold;
        }
        
        .mlo-table td {
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            vertical-align: top;
        }
        
        .mlo-table tr:last-child td {
            border-bottom: none;
        }
        
        .mlo-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        .mlo-code-col {
            width: 6%;
        }
        
        .content-col {
            width: 85%;
        }
        
        .mlo-code {
            font-family: inherit;
            font-size: 0.95em;
            color: #495057;
            font-weight: normal;
        }
        
        .mlo-description {
            font-size: 0.95em;
            line-height: 1.4;
            color: #495057;
        }
        
        /* Global h2 styling */
        h2 {
            color: #342b60 !important; /* TT DARK BLUE */
        }
        
        /* Language Toggle Styles */
        .language-toggle {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #342b60, #AA1352);
            border-radius: 10px;
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .language-toggle label {
            font-weight: bold;
            color: white;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255,255,255,0.3);
            transition: .4s;
            border-radius: 30px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .toggle-slider {
            background-color: rgba(255,255,255,0.5);
        }
        
        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }
        
        .language-label {
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .language-label.active {
            opacity: 1;
            color: #e4067e; /* TT MAGENTA */
            font-weight: 900;
            text-shadow: 0 0 5px rgba(228, 6, 126, 0.3);
        }
        
        .language-label.inactive {
            opacity: 0.6;
            color: rgba(255,255,255,0.7);
        }
        
        /* Overview and Legend Styles */
        .overview-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #AA1352;
        }
        
        .overview-section h2 {
            color: #AA1352;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .score-legend {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .score-legend h3 {
            margin-bottom: 15px;
            color: #342b60;
            font-size: 1.1em;
        }
        
        .legend-items {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: 500;
        }
        
        .legend-score-1 { background-color: #ffebee; color: #c62828; }
        .legend-score-2 { background-color: #fff3e0; color: #ef6c00; }
        .legend-score-3 { background-color: #fff9c4; color: #f57f17; }
        .legend-score-4 { background-color: #e8f5e8; color: #2e7d32; }
        .legend-score-5 { background-color: #e3f2fd; color: #1565c0; }
        
        /* Alignment Summary Styles */
        .alignment-summary {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #342b60;
        }
        
        .alignment-summary h2 {
            color: #342b60;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .summary-content {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #6c757d;
        }
        
        .summary-findings {
            margin-bottom: 20px;
        }
        
        .summary-findings h4 {
            color: #495057;
            margin-bottom: 15px;
        }
        
        .findings-list {
            list-style: none;
            padding: 0;
        }
        
        .findings-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
            color: #6c757d;
        }
        
        .findings-list li:last-child {
            border-bottom: none;
        }
        
        .findings-list strong {
            color: #495057;
        }
        
        .recommendations {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
        }
        
        .recommendations h4 {
            color: #856404;
            margin-bottom: 10px;
        }
        
        .recommendations p {
            color: #856404;
            margin: 0;
            font-size: 0.95em;
        }
        
        /* Alignment Matrix Styles */
        .matrix-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #28a745;
        }
        
        .matrix-section h2 {
            color: #28a745;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .matrix-description {
            color: #6c757d;
            margin-bottom: 15px;
            font-size: 0.95em;
        }
        
        .matrix-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
            margin-top: 15px;
        }
        
        .matrix-table th,
        .matrix-table td {
            border: 1px solid #dee2e6;
            padding: 8px 4px;
            text-align: center;
            vertical-align: middle;
        }
        
        .matrix-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #495057;
            font-size: 0.8em;
        }
        
        .matrix-table .plo-header {
            background-color: #342b60;
            color: white;
            width: 60px;
            font-size: 0.9em;
        }
        
        .matrix-table .module-header {
            background-color: #AA1352;
            color: white;
            font-size: 0.75em;
            padding: 4px 2px;
        }
        
        .matrix-table .mlo-header {
            background-color: #6c757d;
            color: white;
            font-size: 0.7em;
            width: 45px;
            transform: rotate(-45deg);
            transform-origin: center;
            white-space: nowrap;
        }
        
        .score-cell {
            font-weight: bold;
            width: 45px;
            color: #495057;
        }
        
        .score-cell.score-1 { background-color: #ffebee; }
        .score-cell.score-2 { background-color: #fff3e0; }
        .score-cell.score-3 { background-color: #fff9c4; }
        .score-cell.score-4 { background-color: #e8f5e8; }
        .score-cell.score-5 { background-color: #e3f2fd; }
        
        .avg-row {
            background-color: #AA1352 !important;
            color: white !important;
            font-weight: bold;
        }
        
        .avg-row td {
            background-color: #AA1352 !important;
            color: white !important;
        }
        
        .export-btn {
            background-color: #AA1352;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        
        .export-btn:hover {
            background-color: #8a0f3e;
        }
        
        /* Detailed Analysis Styles */
        .detailed-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #dc3545;
        }
        
        .detailed-section h2 {
            color: #dc3545;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .detailed-description {
            color: #6c757d;
            margin-bottom: 20px;
            font-size: 0.95em;
        }
        
        .module-category-section {
            margin-bottom: 30px;
        }
        
        .detailed-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .detailed-table th,
        .detailed-table td {
            border: 1px solid #dee2e6;
            padding: 12px;
            text-align: left;
            vertical-align: top;
        }
        
        .detailed-table th {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #495057;
        }
        
        .module-category-header {
            background-color: #342b60;
            color: white;
            font-weight: bold;
            text-align: center;
        }
        
        .category-average-row {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #495057;
        }
        
        .score-col {
            width: 80px;
            text-align: center;
            font-weight: bold;
        }
        
        .code-col {
            width: 100px;
            font-family: 'Courier New', monospace;
            color: #495057;
        }
        
        .content-col {
            width: 35%;
        }
        
        .justification-col {
            width: 40%;
        }
        
        .improvement-suggestion {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            padding: 8px;
            margin-top: 8px;
            font-size: 0.9em;
            color: #856404;
        }
        
        .improvement-suggestion strong {
            color: #6f5500;
        }
        
        .plo-content-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            border-left: 4px solid #342b60;
        }
        
        .plo-content-section h3 {
            color: #342b60;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .plo-content-box {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .plo-content-box h4 {
            margin: 0 0 10px 0;
            color: #342b60;
            font-size: 1.1em;
        }
        
        .plo-content-box p {
            margin: 0;
            color: #495057;
            line-height: 1.5;
        }
        
        .module-group {
            margin: 30px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .module-header {
            background-color: #342b60;
            color: white;
            padding: 15px 20px;
            margin: 0;
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1><i class="fas fa-graduation-cap"></i> PLO-MLO Learning Outcome Alignment</h1>
                <p>Programme and Module Learning Outcomes Alignment Tool</p>
            </div>
            <button id="home-btn" class="home-btn" style="background-color: #AA1352; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">
                <i class="fas fa-home"></i> Home
            </button>
        </header>

        <main>
            <!-- Language Toggle -->
            <div class="language-toggle">
                <span class="language-label" id="est-label">EST</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="language-toggle" checked>
                    <span class="toggle-slider"></span>
                </label>
                <span class="language-label" id="eng-label">ENG</span>
            </div>

            <section id="overview" class="overview-section">
                <h2><i class="fas fa-info-circle"></i> Overview</h2>
                <p>Loading programme analysis...</p>
                
                <div class="score-legend">
                    <h3>Alignment Score Legend:</h3>
                    <div class="legend-items">
                        <div class="legend-item legend-score-1">1: Minimal alignment</div>
                        <div class="legend-item legend-score-2">2: Partial alignment</div>
                        <div class="legend-item legend-score-3">3: Moderate alignment</div>
                        <div class="legend-item legend-score-4">4: Strong alignment</div>
                        <div class="legend-item legend-score-5">5: Excellent alignment</div>
                    </div>
                </div>
            </section>

            <!-- Alignment Summary Section -->
            <section id="alignment-summary" class="alignment-summary">
                <h2><i class="fas fa-chart-bar"></i> Alignment Summary</h2>
                <div class="summary-content">
                    <p>The analysis examines the relationships between the Programme Learning Outcomes (PLOs) that define the overall goals of the Sustainability Management programme and the Module Learning Outcomes (MLOs) across different course modules. The alignment assessment shows how each module contributes to developing sustainability leadership and management competencies.</p>
                    
                    <div class="summary-findings">
                        <h4>Critical findings for Sustainability Management programme:</h4>
                        <ul class="findings-list">
                            <li><strong>General Studies Module (YL)</strong> shows moderate alignment (2.22/5) with sustainability management goals - needs stronger integration of environmental and social responsibility concepts</li>
                            <li><strong>P1 Methods, Markets and Economy</strong> demonstrates variable alignment (2.03/5) - requires enhanced focus on sustainable business models and circular economy principles</li>
                            <li><strong>P2 Core Business Competences</strong> shows reasonable alignment (2.17/5) but lacks sufficient emphasis on stakeholder engagement and ESG (Environmental, Social, Governance) frameworks</li>
                            <li><strong>Programme lacks specialized sustainability modules</strong> - critical gap in advanced sustainability management, carbon footprint analysis, and green innovation strategies</li>
                            <li><strong>Integration across modules</strong> needs improvement to create cohesive sustainability leadership competencies throughout the curriculum</li>
                        </ul>
                    </div>
                    
                    <div class="recommendations">
                        <h4>Recommended actions for programme enhancement:</h4>
                        <p>Integrate sustainability frameworks into all modules, develop specialized sustainability management courses, strengthen connections between business strategy and environmental impact, and enhance practical application of sustainability metrics and reporting standards.</p>
                    </div>
                </div>
            </section>

            <section id="plo-section">
                <h2><i class="fas fa-graduation-cap"></i> Programme Learning Outcomes (PLOs)</h2>
                <div id="plo-container">
                    <!-- PLOs will be populated here by JavaScript -->
                    <p>Loading PLOs...</p>
                </div>
            </section>

            <section id="mlo-section">
                <h2><i class="fas fa-book"></i> Module Learning Outcomes (MLOs)</h2>
                <div id="mlo-container">
                    <!-- MLOs will be populated here by JavaScript -->
                    <p>Loading MLOs...</p>
                </div>
            </section>

            <section id="matrix-section" class="matrix-section">
                <h2><i class="fas fa-table"></i> Alignment Matrix</h2>
                <p class="matrix-description">This matrix shows the alignment scores between all PLOs and MLO categories. Hover over a cell to see the alignment justification. Click any cell to navigate to the detailed analysis.</p>
                <button class="export-btn" id="export-excel-btn"><i class="fas fa-download"></i> Export Matrix to Excel</button>
                <div id="matrix-container">
                    <!-- Alignment matrix will be generated here by JavaScript -->
                    <p>Loading alignment matrix...</p>
                </div>
            </section>
            
            <section id="detailed-analysis" class="detailed-section">
                <h2><i class="fas fa-list-alt"></i> Detailed Breakdown</h2>
                <p>Below is a detailed breakdown of alignment between Programme Learning Outcomes and Module Learning Outcomes.</p>
                <button class="view-toggle" id="view-toggle-btn"><i class="fas fa-exchange-alt"></i> Switch to MLO View</button>
                <div id="analysis-header" class="analysis-header">
                    <p>Below is a detailed breakdown of alignment between Programme Learning Outcomes and Module Learning Outcomes.</p>
                </div>
                <div id="detailed-container">
                    <!-- Detailed breakdown will be generated here by JavaScript -->
                    <p>Loading detailed analysis...</p>
                </div>
            </section>
        </main>
        
        <!-- Floating Action Buttons -->
        <div class="action-buttons">
            <button id="back-to-top" class="floating-btn back-to-top" title="Back to top">
                <i class="fas fa-chevron-up"></i>
            </button>
        </div>
        
        <div class="report-footer-actions">
            <button id="export-plo-mlo-btn" class="export-btn"><i class="fas fa-file-export"></i> Export Report</button>
        </div>
    </div>

    <script>
        // Global state
        let currentLanguage = 'english'; // Default to English
        let currentProgrammeData = null;
        let currentPLOs = [];
        let currentMLOs = [];

        // Get the programme parameter from URL
        function getURLParameter(name) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(name);
        }

        // Get selected programme from URL parameter or default to 'tvtb'
        const selectedProgramme = getURLParameter('programme') || 'tvtb';
        console.log("=== INITIAL SETUP ===");
        console.log("Selected programme from URL:", selectedProgramme);

        // Programme names mapping
        const programmeNames = {
            'tvtb': { 
                estonian: 'Rahvusvaheline ärikorraldus',
                english: 'International Business Administration'
            },
            'majb': { 
                estonian: 'Jätkusuutlik ettevõtlus ja ringmajandus',
                english: 'Sustainable Entrepreneurship and Circular Economy'
            },
            'makm': { 
                estonian: 'Kestlikkuse juhtimine',
                english: 'Sustainability Management'
            }
        };

        // Module categories order and names
        const moduleOrder = ['yl', 'p1', 'p2', 'e1', 'e2', 'gd', 'mn', 'vb'];
        const moduleNames = {
            yl: {
                estonian: 'Üldõpe',
                english: 'General Studies'
            },
            p1: {
                estonian: 'P1 Meetodid, turud ja majandus',
                english: 'P1 Methods, Markets and Economy'
            },
            p2: {
                estonian: 'P2 Ärinduse põhikompetentsid',
                english: 'P2 Core Business Competences'
            },
            e1: {
                estonian: 'E1 Erialaõpe',
                english: 'E1 Specialized Studies'
            },
            e2: {
                estonian: 'E2 Erialaõpe',
                english: 'E2 Specialized Studies'
            },
            gd: {
                estonian: 'Lõputöö moodul',
                english: 'Graduation Thesis Module'
            },
            mn: {
                estonian: 'Vabaaineõpe',
                english: 'Minor Studies'
            },
            vb: {
                estonian: 'Vabaained',
                english: 'Elective Courses'
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            console.log("=== DOM CONTENT LOADED ===");

            // Language toggle functionality
            const languageToggle = document.getElementById('language-toggle');
            const estLabel = document.getElementById('est-label');
            const engLabel = document.getElementById('eng-label');

            // Initialize language labels
            updateLanguageLabels();

            languageToggle.addEventListener('change', function() {
                currentLanguage = this.checked ? 'english' : 'estonian';
                console.log("Language changed to:", currentLanguage);
                updateLanguageLabels();
                
                // Re-render content if data is available
                if (currentPLOs.length > 0 || currentMLOs.length > 0) {
                    displaySingleLanguageTables(currentPLOs, currentMLOs);
                }
            });

            function updateLanguageLabels() {
                if (currentLanguage === 'english') {
                    estLabel.classList.remove('active');
                    estLabel.classList.add('inactive');
                    engLabel.classList.remove('inactive');
                    engLabel.classList.add('active');
                } else {
                    engLabel.classList.remove('active');
                    engLabel.classList.add('inactive');
                    estLabel.classList.remove('inactive');
                    estLabel.classList.add('active');
                }
            }

            // Home button functionality
            const homeBtn = document.getElementById('home-btn');
            if (homeBtn) {
                homeBtn.addEventListener('click', function() {
                    window.location.href = 'index.html';
                });
            }

            // Back to top button functionality
            const backToTopBtn = document.getElementById('back-to-top');
            if (backToTopBtn) {
                // Show/hide back to top button on scroll
                window.addEventListener('scroll', function() {
                    if (window.pageYOffset > 300) {
                        backToTopBtn.classList.add('visible');
                    } else {
                        backToTopBtn.classList.remove('visible');
                    }
                });

                // Click handler for back to top
                backToTopBtn.addEventListener('click', function() {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }

            // View toggle button functionality
            let currentView = 'plo'; // 'plo' or 'mlo'
            const viewToggleBtn = document.getElementById('view-toggle-btn');
            if (viewToggleBtn) {
                viewToggleBtn.addEventListener('click', function() {
                    currentView = currentView === 'plo' ? 'mlo' : 'plo';
                    updateViewToggleButton();
                    updateDetailedView();
                });
            }

            function updateViewToggleButton() {
                const btn = document.getElementById('view-toggle-btn');
                if (btn) {
                    if (currentView === 'plo') {
                        btn.innerHTML = '<i class="fas fa-exchange-alt"></i> Switch to MLO View';
                    } else {
                        btn.innerHTML = '<i class="fas fa-exchange-alt"></i> Switch to PLO View';
                    }
                }
            }

            function updateDetailedView() {
                const analysisHeader = document.getElementById('analysis-header');
                if (analysisHeader) {
                    if (currentView === 'plo') {
                        analysisHeader.innerHTML = '<p>Below is a detailed breakdown of alignment between Programme Learning Outcomes and Module Learning Outcomes.</p>';
                    } else {
                        analysisHeader.innerHTML = '<p>Below is a detailed breakdown organized by Module Learning Outcomes and their alignment with Programme Learning Outcomes.</p>';
                    }
                }
                
                // Re-generate the detailed analysis with current view
                if (currentPLOs.length > 0 || currentMLOs.length > 0) {
                    const moduleGroups = groupMLOsByCategory(currentMLOs);
                    const alignmentResults = [];
                    displayDetailedAnalysis(currentPLOs, moduleGroups, alignmentResults);
                }
            }

            // Load the data from the JSON file
            // Update alignment summary based on programme
            function updateAlignmentSummary(programmeCode, programmeName) {
                const alignmentSummaries = {
                    'tvtb': {
                        description: 'The analysis examines the relationships between the Programme Learning Outcomes (PLOs) that define the overall goals of the International Business Administration programme and the Module Learning Outcomes (MLOs) across different course modules. The alignment assessment shows how each module contributes to developing global business competencies and international trade expertise.',
                        title: 'Critical findings for International Business Administration programme:',
                        findings: [
                            '<strong>General Studies Module (YL)</strong> shows moderate alignment (2.22/5) with international business goals - needs stronger integration of global market dynamics and cross-cultural communication concepts',
                            '<strong>P1 Methods, Markets and Economy</strong> demonstrates variable alignment (2.03/5) - requires enhanced focus on international trade theories and global supply chain management',
                            '<strong>P2 Core Business Competences</strong> shows reasonable alignment (2.17/5) but lacks sufficient emphasis on international market entry strategies and multinational corporation management',
                            '<strong>Programme lacks specialized international business modules</strong> - critical gap in international finance, global marketing strategies, and cross-border business law',
                            '<strong>Integration across modules</strong> needs improvement to create cohesive international business leadership competencies throughout the curriculum'
                        ],
                        recommendations: 'Integrate international business frameworks into all modules, develop specialized global market analysis courses, strengthen connections between local and international business practices, and enhance practical application of international trade regulations and global business ethics.'
                    },
                    'majb': {
                        description: 'The analysis examines the relationships between the Programme Learning Outcomes (PLOs) that define the overall goals of the Sustainable Entrepreneurship programme and the Module Learning Outcomes (MLOs) across different course modules. The alignment assessment shows how each module contributes to developing sustainable business innovation and entrepreneurial competencies.',
                        title: 'Critical findings for Sustainable Entrepreneurship programme:',
                        findings: [
                            '<strong>General Studies Module (YL)</strong> shows moderate alignment (2.22/5) with sustainable entrepreneurship goals - needs stronger integration of innovation methodologies and sustainable business model concepts',
                            '<strong>P1 Methods, Markets and Economy</strong> demonstrates variable alignment (2.03/5) - requires enhanced focus on green economy principles and social entrepreneurship frameworks',
                            '<strong>P2 Core Business Competences</strong> shows reasonable alignment (2.17/5) but lacks sufficient emphasis on impact measurement and sustainable venture capital strategies',
                            '<strong>Programme lacks specialized entrepreneurship modules</strong> - critical gap in startup incubation, social impact assessment, and sustainable innovation management',
                            '<strong>Integration across modules</strong> needs improvement to create cohesive sustainable entrepreneurship competencies throughout the curriculum'
                        ],
                        recommendations: 'Integrate sustainable entrepreneurship frameworks into all modules, develop specialized social innovation courses, strengthen connections between business viability and environmental impact, and enhance practical application of impact metrics and sustainable business development strategies.'
                    },
                    'makm': {
                        description: 'The analysis examines the relationships between the Programme Learning Outcomes (PLOs) that define the overall goals of the Sustainability Management programme and the Module Learning Outcomes (MLOs) across different course modules. The alignment assessment shows how each module contributes to developing sustainability leadership and management competencies.',
                        title: 'Critical findings for Sustainability Management programme:',
                        findings: [
                            '<strong>General Studies Module (YL)</strong> shows moderate alignment (2.22/5) with sustainability management goals - needs stronger integration of environmental and social responsibility concepts',
                            '<strong>P1 Methods, Markets and Economy</strong> demonstrates variable alignment (2.03/5) - requires enhanced focus on sustainable business models and circular economy principles',
                            '<strong>P2 Core Business Competences</strong> shows reasonable alignment (2.17/5) but lacks sufficient emphasis on stakeholder engagement and ESG (Environmental, Social, Governance) frameworks',
                            '<strong>Programme lacks specialized sustainability modules</strong> - critical gap in advanced sustainability management, carbon footprint analysis, and green innovation strategies',
                            '<strong>Integration across modules</strong> needs improvement to create cohesive sustainability leadership competencies throughout the curriculum'
                        ],
                        recommendations: 'Integrate sustainability frameworks into all modules, develop specialized sustainability management courses, strengthen connections between business strategy and environmental impact, and enhance practical application of sustainability metrics and reporting standards.'
                    }
                };

                const summaryData = alignmentSummaries[programmeCode] || alignmentSummaries['makm']; // fallback to MAKM
                
                const summaryContent = document.querySelector('.summary-content');
                if (summaryContent) {
                    const programmeLongName = programmeName ? programmeName.english : 'the programme';
                    
                    summaryContent.innerHTML = `
                        <p>${summaryData.description}</p>
                        
                        <div class="summary-findings">
                            <h4>${summaryData.title}</h4>
                            <ul class="findings-list">
                                ${summaryData.findings.map(finding => `<li>${finding}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div class="recommendations">
                            <h4>Recommended actions for programme enhancement:</h4>
                            <p>${summaryData.recommendations}</p>
                        </div>
                    `;
                }
            }

            async function loadProgrammeData(programmeCode = 'tvtb') {
                console.log("=== LOADING PROGRAMME DATA ===");
                console.log("Programme code:", programmeCode);
                try {
                    const response = await fetch('data/programmes.json');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    console.log("Data loaded successfully");
                    
                    // Check if the programme exists in the data
                    if (data[programmeCode]) {
                        console.log("Programme data found for:", programmeCode);
                        currentProgrammeData = data[programmeCode];
                        console.log("Programme name:", currentProgrammeData.kavanimetusik || currentProgrammeData.kavanimetusek);
                        
                        // Update page title and header with programme name
                        const programmeName = programmeNames[programmeCode];
                        if (programmeName) {
                            document.title = `${programmeName.english} - Learning Outcome Alignment`;
                            
                            // Update header content
                            const headerTitle = document.querySelector('header h1');
                            if (headerTitle) {
                                headerTitle.innerHTML = `<i class="fas fa-graduation-cap"></i> ${programmeName.estonian} (${programmeCode.toUpperCase()})`;
                                console.log("Header title updated");
                            }
                            
                            // Update subtitle
                            const headerSubtitle = document.querySelector('header p');
                            if (headerSubtitle) {
                                headerSubtitle.textContent = `${programmeName.english} - Programme and Module Learning Outcomes Alignment`;
                                console.log("Header subtitle updated");
                            }
                        }
                        
                        // Update overview section to be dynamic
                        const overviewText = document.querySelector('#overview > p');
                        if (overviewText) {
                            const estName = programmeName ? programmeName.estonian : (currentProgrammeData.kavanimetusik || currentProgrammeData.kavanimetusek);
                            overviewText.textContent = `This analysis examines how well the Module Learning Outcomes (MLOs) align with the Programme Learning Outcomes (PLOs) for ${estName} (${programmeCode.toUpperCase()}). The alignment is scored on a scale from 1 to 5:`;
                            console.log("Overview text updated");
                        }

                        // Update alignment summary to be dynamic
                        updateAlignmentSummary(programmeCode, programmeName);
                        console.log("Alignment summary updated");

                        // Get PLOs and MLOs
                        currentPLOs = currentProgrammeData.plos || [];
                        currentMLOs = currentProgrammeData.mlos || [];
                        
                        console.log("PLOs count:", currentPLOs.length);
                        console.log("MLOs count:", currentMLOs.length);
                        
                        if (currentPLOs.length > 0 || currentMLOs.length > 0) {
                            // Display single language tables
                            displaySingleLanguageTables(currentPLOs, currentMLOs);
                            
                            // Group MLOs by category for analysis
                            const moduleGroups = groupMLOsByCategory(currentMLOs);
                            
                            // Generate and display alignment analysis
                            const alignmentResults = []; // Placeholder for actual analysis
                            displayAlignmentMatrix(currentPLOs, moduleGroups, alignmentResults);
                            displayDetailedAnalysis(currentPLOs, moduleGroups, alignmentResults);
                            
                            console.log("=== ANALYSIS COMPLETE ===");
                        } else {
                            console.error(`No PLO or MLO data found for programme code ${programmeCode}`);
                        }
                    } else {
                        console.error(`Programme code ${programmeCode} not found in the data`);
                    }
                } catch (error) {
                    console.error("Error loading programme data:", error);
                }
            }

            // Function to parse module category from MLO code
            function getModuleCategory(mloCode) {
                // Parse module code from mlokood (e.g., "p1_mlo1" -> "p1")
                const parts = mloCode.split('_');
                return parts.length > 1 ? parts[0] : 'unknown';
            }

            // Function to group MLOs by category
            function groupMLOsByCategory(mlos) {
                const groups = {};
                moduleOrder.forEach(category => {
                    groups[category] = [];
                });
                
                mlos.forEach(mlo => {
                    const category = getModuleCategory(mlo.mlokood || '');
                    if (groups[category]) {
                        groups[category].push(mlo);
                    }
                });
                
                return groups;
            }

            // Function to display single language PLO and MLO tables
            function displaySingleLanguageTables(plos, mlos) {
                // Display PLOs
                const ploContainer = document.getElementById('plo-container');
                if (ploContainer && plos.length > 0) {
                    let ploHtml = `<table class="mlo-table">`;
                    ploHtml += `<thead>`;
                    ploHtml += `<tr>`;
                    ploHtml += `<th class="mlo-code-col">PLO Code</th>`;
                    ploHtml += `<th class="content-col">${currentLanguage === 'english' ? 'English' : 'Estonian'}</th>`;
                    ploHtml += `</tr>`;
                    ploHtml += `</thead>`;
                    ploHtml += `<tbody>`;
                    
                    plos.forEach((plo, i) => {
                        const content = currentLanguage === 'english' 
                            ? (plo.plosisuik || plo.ilosisu || 'N/A')
                            : (plo.plosisuek || plo.ilosisu || 'N/A');
                            
                        ploHtml += `<tr>`;
                        ploHtml += `<td class="mlo-code">${plo.plokood || `plo${i+1}`}</td>`;
                        ploHtml += `<td class="content-cell">`;
                        ploHtml += `<div class="mlo-description">${content}</div>`;
                        ploHtml += `</td>`;
                        ploHtml += `</tr>`;
                    });
                    
                    ploHtml += `</tbody>`;
                    ploHtml += `</table>`;
                    ploContainer.innerHTML = ploHtml;
                } else if (ploContainer) {
                    ploContainer.innerHTML = '<p>No PLOs available for this programme.</p>';
                }

                // Display MLOs grouped by module category
                const mloContainer = document.getElementById('mlo-container');
                if (mloContainer && mlos.length > 0) {
                    // Group MLOs by module category parsed from mlokood
                    const groupedMLOs = {};
                    mlos.forEach(mlo => {
                        const category = getModuleCategory(mlo.mlokood || '');
                        if (!groupedMLOs[category]) {
                            groupedMLOs[category] = [];
                        }
                        groupedMLOs[category].push(mlo);
                    });

                    let mloHtml = '<div class="mlo-groups">';
                    
                    // Display groups in the specified order
                    moduleOrder.forEach(category => {
                        if (groupedMLOs[category] && groupedMLOs[category].length > 0) {
                            // Get the module title from the first MLO in the group
                            const firstMLO = groupedMLOs[category][0];
                            const moduleTitle = currentLanguage === 'english' 
                                ? (firstMLO.mlonimetusik || moduleNames[category]?.english || category.toUpperCase())
                                : (firstMLO.mlonimetusek || moduleNames[category]?.estonian || category.toUpperCase());
                            
                            mloHtml += `<div class="module-group">`;
                            
                            // Create single language table without module header
                            mloHtml += `<table class="mlo-table">`;
                            mloHtml += `<thead>`;
                            mloHtml += `<tr>`;
                            mloHtml += `<th class="mlo-code-col">MLO Code</th>`;
                            mloHtml += `<th class="content-col">${moduleTitle}</th>`;
                            mloHtml += `</tr>`;
                            mloHtml += `</thead>`;
                            mloHtml += `<tbody>`;
                            
                            groupedMLOs[category].forEach((mlo, i) => {
                                const content = currentLanguage === 'english' 
                                    ? (mlo.mlosisuik || mlo.ilosisu || 'N/A')
                                    : (mlo.mlosisuek || mlo.ilosisu || 'N/A');
                                    
                                mloHtml += `<tr>`;
                                mloHtml += `<td class="mlo-code">${mlo.mlokood || `${category}_mlo${i+1}`}</td>`;
                                mloHtml += `<td class="content-cell">`;
                                mloHtml += `<div class="mlo-description">${content}</div>`;
                                mloHtml += `</td>`;
                                mloHtml += `</tr>`;
                            });
                            
                            mloHtml += `</tbody>`;
                            mloHtml += `</table>`;
                            mloHtml += `</div>`;
                        }
                    });
                    
                    mloHtml += '</div>';
                    mloContainer.innerHTML = mloHtml;
                } else if (mloContainer) {
                    mloContainer.innerHTML = '<p>No MLOs available for this programme.</p>';
                }
            }

            // Simplified alignment analysis functions (placeholders for future implementation)
            function displayAlignmentMatrix(plos, moduleGroups, alignmentResults) {
                const matrixContainer = document.getElementById('matrix-container');
                if (matrixContainer) {
                    
                    let matrixHtml = `
                        <table class="matrix-table">
                            <thead>
                                <tr>
                                    <th rowspan="2" class="plo-header">PLO / MLO</th>
                                    <th colspan="4" class="module-header">General Studies Module</th>
                                    <th colspan="6" class="module-header">P1: Methods, Markets and Economy</th>
                                    <th colspan="6" class="module-header">P2: Core Business Competences</th>
                                </tr>
                                <tr>
                                    <th class="mlo-header">YLMLO 1</th>
                                    <th class="mlo-header">YLMLO 2</th>
                                    <th class="mlo-header">YLMLO 3</th>
                                    <th class="mlo-header">Avg</th>
                                    <th class="mlo-header">P1MLO 1</th>
                                    <th class="mlo-header">P1MLO 2</th>
                                    <th class="mlo-header">P1MLO 3</th>
                                    <th class="mlo-header">P1MLO 4</th>
                                    <th class="mlo-header">P1MLO 5</th>
                                    <th class="mlo-header">Avg</th>
                                    <th class="mlo-header">P2MLO 1</th>
                                    <th class="mlo-header">P2MLO 2</th>
                                    <th class="mlo-header">P2MLO 3</th>
                                    <th class="mlo-header">P2MLO 4</th>
                                    <th class="mlo-header">P2MLO 5</th>
                                    <th class="mlo-header">Avg</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="plo-header">PLO 1</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-4">4</td>
                                    <td class="score-cell score-3">2.67</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-1">1</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2.00</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2.20</td>
                                </tr>
                                <tr>
                                    <td class="plo-header">PLO 2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2.00</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2.40</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-2">2.40</td>
                                </tr>
                                <tr>
                                    <td class="plo-header">PLO 3</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2.00</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2.00</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-2">2.20</td>
                                </tr>
                                <tr>
                                    <td class="plo-header">PLO 4</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-4">4</td>
                                    <td class="score-cell score-3">2.67</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-1">1</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2.00</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2.20</td>
                                </tr>
                                <tr>
                                    <td class="plo-header">PLO 5</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2.00</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-1">1</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">1.80</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-1">1</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">1.80</td>
                                </tr>
                                <tr>
                                    <td class="plo-header">PLO 6</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2.00</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-1">1</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2.00</td>
                                    <td class="score-cell score-3">3</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2</td>
                                    <td class="score-cell score-2">2.20</td>
                                </tr>
                                <tr class="avg-row">
                                    <td>Avg</td>
                                    <td>2.00</td>
                                    <td>2.00</td>
                                    <td>2.67</td>
                                    <td>2.22</td>
                                    <td>2.00</td>
                                    <td>1.83</td>
                                    <td>2.67</td>
                                    <td>1.67</td>
                                    <td>2.00</td>
                                    <td>2.03</td>
                                    <td>2.50</td>
                                    <td>2.17</td>
                                    <td>1.83</td>
                                    <td>2.00</td>
                                    <td>2.33</td>
                                    <td>2.17</td>
                                </tr>
                            </tbody>
                        </table>
                    `;
                    
                    matrixContainer.innerHTML = matrixHtml;
                }
            }

            function displayDetailedAnalysis(plos, moduleGroups, alignmentResults) {
                const detailedContainer = document.getElementById('detailed-container');
                if (detailedContainer) {
                    
                    // Sample PLO content for Sustainability Management programme
                    const ploContent = {
                        'PLO 1': 'Synthesizes wide-ranging knowledge and skills to overcome challenges in international organizations in various sectors as an employee, to run one\'s own business, and/or to continue studies on graduate level.',
                        'PLO 2': 'Demonstrates critical thinking and analytical skills in evaluating complex sustainability challenges in business environments.',
                        'PLO 3': 'Applies sustainability frameworks and ESG principles to develop innovative business solutions and strategies.',
                        'PLO 4': 'Communicates effectively with diverse stakeholders about sustainability initiatives and environmental impact assessments.',
                        'PLO 5': 'Leads and manages sustainable business transformations while considering economic, environmental, and social implications.',
                        'PLO 6': 'Integrates circular economy principles and green innovation strategies into organizational decision-making processes.'
                    };
                    
                    // Enhanced MLO analysis data with more specific justifications
                    const sampleData = {
                        'yl': {
                            name: 'General Studies Module',
                            avgScore: 2.2,
                            mlos: [
                                {
                                    code: 'yl_mlo1',
                                    content: 'Knows the basic principles of ICT, is able to find and evaluate information efficiently.',
                                    score: 2,
                                    justification: 'While information evaluation skills support PLO 1\'s knowledge synthesis requirement, the focus on basic ICT lacks connection to sustainability management contexts. Missing integration with environmental data analysis tools and sustainability reporting systems.',
                                    needsImprovement: true
                                },
                                {
                                    code: 'yl_mlo2',
                                    content: 'Can scientifically interpret the effect of work environment on human body.',
                                    score: 2,
                                    justification: 'Limited alignment with sustainability PLOs. While workplace health relates to social sustainability (PLO 3), the narrow focus on human body effects doesn\'t address broader environmental and economic sustainability dimensions required by the programme.',
                                    needsImprovement: true
                                },
                                {
                                    code: 'yl_mlo3',
                                    content: 'Demonstrates critical thinking and problem-solving skills in academic contexts.',
                                    score: 4,
                                    justification: 'Strong alignment with PLO 2\'s critical thinking requirements. The analytical skills developed here directly support evaluating complex sustainability challenges, though application contexts could be more specifically oriented toward sustainability issues.',
                                    needsImprovement: false
                                }
                            ]
                        },
                        'p1': {
                            name: 'P1 Methods, Markets and Economy',
                            avgScore: 2.0,
                            mlos: [
                                {
                                    code: 'p1_mlo1',
                                    content: 'Understands fundamental economic principles and market mechanisms.',
                                    score: 2,
                                    justification: 'Basic economic knowledge provides foundation for PLO 1, but lacks integration with sustainability economics, circular economy models, and green market mechanisms essential for sustainability management leadership.',
                                    needsImprovement: true
                                },
                                {
                                    code: 'p1_mlo2',
                                    content: 'Applies research methods in business contexts.',
                                    score: 2,
                                    justification: 'Research methodology skills partially support PLO 2\'s analytical requirements, but need stronger focus on sustainability assessment methodologies, life cycle analysis, and environmental impact measurement techniques.',
                                    needsImprovement: true
                                },
                                {
                                    code: 'p1_mlo3',
                                    content: 'Analyzes market trends and competitive landscapes.',
                                    score: 3,
                                    justification: 'Market analysis skills align moderately with PLO 3\'s business strategy requirements, but need enhancement to include green market trends, sustainable competitive advantages, and ESG-driven market dynamics.',
                                    needsImprovement: false
                                },
                                {
                                    code: 'p1_mlo4',
                                    content: 'Evaluates economic policies and their business implications.',
                                    score: 1,
                                    justification: 'Limited connection to sustainability PLOs. Traditional economic policy analysis doesn\'t address carbon pricing, environmental regulations, sustainability incentives, or green policy frameworks critical for PLO 5\'s leadership requirements.',
                                    needsImprovement: true
                                },
                                {
                                    code: 'p1_mlo5',
                                    content: 'Demonstrates understanding of international trade and global markets.',
                                    score: 2,
                                    justification: 'International perspective supports PLO 1\'s global challenge focus, but lacks emphasis on sustainable trade practices, fair trade principles, and global environmental agreements essential for sustainability management.',
                                    needsImprovement: true
                                }
                            ]
                        }
                    };
                    
                    let detailedHtml = `
                        <h2><i class="fas fa-list-alt"></i> Detailed PLO-MLO Breakdown</h2>
                        <p class="detailed-description">Comprehensive analysis showing how each Programme Learning Outcome aligns with Module Learning Outcomes, including specific justifications and improvement recommendations.</p>
                    `;
                    
                    // Show PLO content first
                    detailedHtml += `
                        <div class="plo-content-section">
                            <h3><i class="fas fa-graduation-cap"></i> Programme Learning Outcomes (PLOs)</h3>
                    `;
                    
                    Object.keys(ploContent).forEach(ploKey => {
                        detailedHtml += `
                            <div class="plo-content-box">
                                <h4>${ploKey}</h4>
                                <p>${ploContent[ploKey]}</p>
                            </div>
                        `;
                    });
                    
                    detailedHtml += `</div>`;
                    
                    // Create detailed MLO analysis table for each module category
                    Object.keys(sampleData).forEach(moduleKey => {
                        const moduleData = sampleData[moduleKey];
                        
                        detailedHtml += `
                            <div class="module-category-section">
                                <table class="detailed-table">
                                    <thead>
                                        <tr class="module-category-header">
                                            <th colspan="4">${moduleData.name} (Average Score: ${moduleData.avgScore}/5)</th>
                                        </tr>
                                        <tr>
                                            <th class="code-col">MLO Code</th>
                                            <th class="content-col">MLO Content</th>
                                            <th class="score-col">Score</th>
                                            <th class="justification-col">Detailed Justification & Improvement</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                        `;
                        
                        moduleData.mlos.forEach(mlo => {
                            detailedHtml += `
                                <tr>
                                    <td class="code-col">${mlo.code}</td>
                                    <td class="content-col">${mlo.content}</td>
                                    <td class="score-col">${mlo.score}/5</td>
                                    <td class="justification-col">
                                        <div>${mlo.justification}</div>
                                        ${mlo.needsImprovement ? `
                                        <div class="improvement-suggestion">
                                            <strong>Improvement Recommendation:</strong> 
                                            Enhance this MLO by incorporating specific sustainability management concepts, frameworks, and practical applications that directly support the programme's environmental, social, and governance learning objectives.
                                        </div>
                                        ` : ''}
                                    </td>
                                </tr>
                            `;
                        });
                        
                        // Add category average row
                        detailedHtml += `
                                        <tr class="category-average-row">
                                            <td colspan="2"><strong>Module Category Assessment</strong></td>
                                            <td class="score-col"><strong>${moduleData.avgScore}/5</strong></td>
                                            <td class="justification-col">
                                                ${moduleData.avgScore < 3 ? 
                                                '<strong>Critical improvement needed:</strong> This module requires substantial enhancement to align with sustainability management programme objectives. Consider integrating ESG frameworks, circular economy principles, and stakeholder engagement methodologies.' : 
                                                '<strong>Satisfactory alignment:</strong> This module demonstrates reasonable alignment with programme goals but could benefit from stronger sustainability focus and practical application opportunities.'}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        `;
                    });
                    
                    detailedContainer.innerHTML = detailedHtml;
                }
            }

            // Add export functionality
            const exportBtn = document.getElementById('export-plo-mlo-btn');
            if (exportBtn) {
                exportBtn.addEventListener('click', function() {
                    alert('Export functionality will be implemented');
                });
            }

            const exportExcelBtn = document.getElementById('export-excel-btn');
            if (exportExcelBtn) {
                exportExcelBtn.addEventListener('click', function() {
                    alert('Excel export functionality will be implemented');
                });
            }

            // Load programme data based on URL parameter
            console.log("Loading programme data for:", selectedProgramme);
            loadProgrammeData(selectedProgramme);
        });
    </script>
</body>
</html>
